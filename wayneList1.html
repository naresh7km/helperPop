function setCookie(name, value, days) {
  const expires = new Date(Date.now() + days * 864e5 ).toUTCString();
  document.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/';
}

function getCookie(name) {
  return document.cookie.split('; ').reduce((r , v) => {
    const parts = v.split('=');
    return parts[0] === name ? decodeURIComponent(parts[1] ) : r;
  }, '');
}

let phoneCookie = getCookie("phoneNumber");
window.addEventListener("message", function(event) {
  const data = event.data;
  const iframe = document.querySelector("iframe");

  console.log("Message received from iframe:", data);

  if (data && typeof data.phoneFromFrame === "string") {
    console.log("Phone from iframe:", data.phoneFromFrame);

    if (!phoneCookie) {
      setCookie("phoneNumber", data.phoneFromFrame, 1);
      phoneCookie = data.phoneFromFrame;
    }

    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.postMessage({ phone: phoneCookie }, "*");
    }
  }
});